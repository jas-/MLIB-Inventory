<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mariott Library Inventory Management</title>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- CSS enabling mobile frome work (jQuery Mobile) -->
		<link rel="stylesheet"  href="css/themes/default/jquery.mobile-1.2.0.css" />
		<link rel="stylesheet"  href="css/themes/custom/custom.min.css" />

		<!-- jQuery libraries -->
		<script src="js/jquery.js"></script>
		<script src="js/jquery.mobile-1.2.0.min.js"></script>

  </head>

<body>

<div data-role="page" id="main">

	<!-- Header -->
	<div data-theme="c" data-role="header">
		<h3>
			<span align="left"><a href=""><img src="images/inventory_categories.png" alt="Inventory Management" title="Inventory Management" height="56" /></a><a href="http://www.utah.edu/"><img src="images/marriottHeader-U.gif" alt="The University of Utah" title="The University of Utah" /></a><a href="index.php"><img src="images/marriottHeader-title.gif" alt="J. Willard Marriott Library, The University of Utah" title="J. Willard Marriott Library, The University of Utah" /></a></span>
		</h3>

		<div data-role="collapsible-set" data-theme="c" data-content-theme="c">

			<!-- Current inventory (remote) -->
			<div data-role="collapsible">
				<h3>
					Current Inventory
				</h3>
				<div data-role="content">
					<div>
						<div id='jqxWidget' style="font-size: 13px; font-family: Verdana; float: left;">
							<div id="jqxgrid"></div>
						</div>
					</div>
				</div>
			</div>

			<!-- Search inventory -->
			<div data-role="collapsible">
				<h3>
					Search Inventory
				</h3>
				<div data-role="content">
					<form action="?do=search" id="search-computer">
						<div data-role="fieldcontain">
							<fieldset data-role="controlgroup" data-mini="true" method="post">
								<label for="search-computers">
									Search computers
								</label>
								<input name="search-computers" placeholder="Search computers" value="" type="search">
							</fieldset>
						</div>
					</form>
					<form action="?do=search-monitors" id="search-monitors" method="post">
						<div data-role="fieldcontain">
							<fieldset data-role="controlgroup" data-mini="true">
								<label for="search-monitors">
									Search monitors
								</label>
								<input name="search-monitors" placeholder="Search monitors" value="" type="search">
							</fieldset>
						</div>
					</form>
				</div>
			</div>

			<!-- Manage inventory -->
			<div data-role="collapsible">
				<h3>
					Add / Edit / Delete Inventory
				</h3>
				<div data-role="content">
					<form action="?do=add" id="add-computer" name="add-computer" method="post">
						<div data-role="fieldcontain">
							<fieldset data-role="controlgroup" data-mini=true>
								<label for="hostname">
									Hostname
								</label>
								<input id="hostname" name="hostname" placeholder="Computer name" type="text">
							</fieldset>
						</div>
						<div data-role="fieldcontain">
							<fieldset data-role="controlgroup" data-mini=true>
								<label for="sku">
									SKU
								</label>
								<input id="sku" name="sku" placeholder="SKU (white barcode)" type="text">
							</fieldset>
						</div>
						<div data-role="fieldcontain">
							<fieldset data-role="controlgroup" data-mini=true>
								<label for="uuic">
									UUIC
								</label>
								<input id="uuic" name="uuic" placeholder="UUIC (yellow sticker)" type="text">
							</fieldset>
						</div>
						<div data-role="fieldcontain">
							<fieldset data-role="controlgroup" data-mini=true>
								<label for="serial">
									Serial
								</label>
								<input id="serial" name="serial" placeholder="Serial (Red label)" type="text">
							</fieldset>
						</div>
						<input data-theme="c" data-icon="arrow-r" data-iconpos="right" value="Submit" type="submit">
					</form>
				</div>
			</div>

			<!-- Manually force update -->
			<div data-role="collapsible">
				<h3>
					Update changes
				</h3>
			</div>
		</div>
		<div style="text-align: center; padding-bottom: 1%">
			<span style="font-size: .7em;font-weight: normal">
				&copy; University Of Utah - Marriott Library 2013
			</span>
		</div>
	</div>
</div>

<!-- jQuery.offline for storage, pulling & pushing data -->
<script src="js/jquery.offline.js"></script>

<!-- jqwidgets for display grid -->
<link rel="stylesheet" href="js/jqWidgets/jqwidgets/styles/jqx.base.css" type="text/css" />
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxcore.js"></script>
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxdata.js"></script> 
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxbuttons.js"></script>
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxscrollbar.js"></script>
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxlistbox.js"></script>
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxdropdownlist.js"></script>
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxmenu.js"></script>
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxgrid.js"></script>
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxgrid.sort.js"></script> 
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxgrid.pager.js"></script> 
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxgrid.columnsresize.js"></script> 
<script type="text/javascript" src="js/jqWidgets/jqwidgets/jqxgrid.selection.js"></script> 
<script type="text/javascript" src="js/jqWidgets/scripts/gettheme.js"></script>
<script>
  $(document).ready(function(){
		var _data = false;

		$('#current-inventory').offline({
			appID:'MLIB-Inventory',
			url: 'http://new-inventory.scl.utah.edu/?do=current',
			debug: true,
			callback: function(){
				$.jqx.dataAdapter($(this))
				_data = $(this);
			}
		});

		var theme = getDemoTheme();

		var customsortfunc = function (column, direction) {
			var sortdata = new Array();

			if (direction == 'ascending') direction = true;
			if (direction == 'descending') direction = false;

			if (direction != null) {
				for (i = 0; i < _data.length; i++) {
					sortdata.push(_data[i]);
				}
			} else {
				sortdata = _data;
			}

			var tmpToString = Object.prototype.toString;
			Object.prototype.toString = (typeof column == "function") ? column : function () { return this[column] };
			if (direction != null) {
				sortdata.sort(compare);
				if (!direction) {
					sortdata.reverse();
				}
			}
			source.localdata = sortdata;
			$("#jqxgrid").jqxGrid('databind', source, 'sort');
			Object.prototype.toString = tmpToString;
		}

		var compare = function (value1, value2) {
			value1 = String(value1).toLowerCase();
			value2 = String(value2).toLowerCase();

			try {
				var tmpvalue1 = parseFloat(value1);
				if (isNaN(tmpvalue1)) {
					if (value1 < value2) { return -1; }
					if (value1 > value2) { return 1; }
				} else {
					var tmpvalue2 = parseFloat(value2);
					if (tmpvalue1 < tmpvalue2) { return -1; }
					if (tmpvalue1 > tmpvalue2) { return 1; }
				}
			} catch (error) {
				var er = error;
			}
			return 0;
		};

		var source = {
			localdata: _data,
			sort: customsortfunc,
			datafields:[
				{ name: 'hostname', type: 'string' },
				{ name: 'sku', type: 'string' },
				{ name: 'serial', type: 'string' },
				{ name: 'uuic', type: 'number' },
				{ name: 'monitor', type: 'number' },
				{ name: 'sku', type: 'number' }
			],
			datatype: "json"
		};
		var dataAdapter = new $.jqx.dataAdapter(source);

		$("#jqxgrid").jqxGrid({
			width: 900,
			source: dataAdapter,
			theme: theme,
			sortable: true,
			pageable: true,
			autoheight: true,
			ready: function () {
				$("#jqxgrid").jqxGrid('sortby', 'hostname', 'asc');
			},
			columns: [
				{ text: 'Hostname', datafield: 'hostname', width: 100 },
				{ text: 'SKU', datafield: 'sku', width: 100 },
				{ text: 'Serial', datafield: 'serial', width: 180 },
				{ text: 'UUIC', datafield: 'uuic', width: 80, cellsalign: 'right' },
				{ text: 'Monitor hostname', datafield: 'monitor', width: 90, cellsalign: 'right', cellsformat: 'c2' },
				{ text: 'Monitor SKU', datafield: 'sku', cellsalign: 'right', cellsformat: 'c2' }
			]
		});

		function _size(obj){
			var n = 0;
			if (/object/.test(typeof(obj))) {
				$.each(obj, function(k, v){
					if (obj.hasOwnProperty(k)) n++;
				});
			} else if (/array/.test(typeof(obj))) {
				n = obj.length;
			}
			return n;
		}

	});
</script>
</body>
